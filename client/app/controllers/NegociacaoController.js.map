{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataConverter","getNegociacaoDao","Bind","getExceptionMessage","debounce","controller","bindEvent","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","Object","assign","_negociacoes","_mensagem","_service","_init","dao","negociacoes","listaTodos","forEach","adiciona","negociacao","err","texto","event","_criaNegociacao","_limpaFormulario","value","focus","DateConverter","paraData","parseInt","parseFloat","importaNegociacoes","obtemNegociacoesDoPeriodo","console","log","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente","apaga","apagaTodos","esvazia"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from '../domain/index.js';\r\nimport { NegociacoesView, MensagemView, Mensagem, DataConverter } from '../ui/index.js';\r\nimport { getNegociacaoDao, Bind, getExceptionMessage, debounce, controller, bindEvent } from '../util/index.js';\r\n\r\n@controller('#data', '#quantidade', '#valor')\r\nexport class NegociacaoController {\r\n\r\n    constructor(_inputData, _inputQuantidade, _inputValor) {\r\n\r\n        Object.assign(this, { _inputData, _inputQuantidade, _inputValor })\r\n\r\n        this._negociacoes = new Bind(\r\n            new Negociacoes(),\r\n            new NegociacoesView('#negociacoes'),\r\n            'adiciona', 'esvazia'\r\n        );\r\n\r\n        this._mensagem = new Bind(\r\n            new Mensagem(),\r\n            new MensagemView('#mensagemView'),\r\n            'texto'\r\n        );\r\n\r\n        this._service = new NegociacaoService();\r\n\r\n        this._init();\r\n    }\r\n\r\n    async _init() {\r\n\r\n        try {\r\n            const dao = await getNegociacaoDao();\r\n            const negociacoes = await dao.listaTodos();\r\n            negociacoes.forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n        } catch (err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n\r\n    @bindEvent('submit', '.form')\r\n    @debounce()\r\n    async adiciona(event) {\r\n\r\n        try {\r\n            const negociacao = this._criaNegociacao();\r\n            const dao = await getNegociacaoDao();\r\n            await dao.adiciona(negociacao);\r\n            this._negociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = 'Negociação adicionada com sucesso';\r\n            this._limpaFormulario();\r\n        } catch (err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n\r\n    _limpaFormulario() {\r\n\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0\r\n        this._inputData.focus();\r\n    }\r\n\r\n    _criaNegociacao() {\r\n\r\n        return new Negociacao(\r\n            DateConverter.paraData(this._inputData.value),\r\n            parseInt(this._inputQuantidade.value),\r\n            parseFloat(this._inputValor.value)\r\n        );\r\n    }\r\n\r\n    @bindEvent('click', '#botao-importa')\r\n    @debounce()\r\n    async importaNegociacoes() {\r\n\r\n        try {\r\n            const negociacoes = await this._service.obtemNegociacoesDoPeriodo();\r\n            console.log(negociacoes);\r\n            negociacoes.filter(novaNegociacao =>\r\n\r\n                !this._negociacoes.paraArray().some(negociacaoExistente =>\r\n                    novaNegociacao.equals(negociacaoExistente)))\r\n                .forEach(negociacao => this._negociacoes.adiciona(negociacao));\r\n\r\n            this._mensagem.texto = 'Negociações do período importadas com sucesso';\r\n        } catch (err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n\r\n    @bindEvent('click', '#botao-apaga')\r\n    async apaga() {\r\n\r\n        try {\r\n            const dao = await getNegociacaoDao();\r\n            await dao.apagaTodos();\r\n            this._negociacoes.esvazia();\r\n            this._mensagem.texto = 'Negociações apagadas com sucesso';\r\n        } catch (err) {\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n}\r\n"]}